import sys
import os
import json
import requests
import time
from models import ComponentCheck
import datetime


def check_each_component_vulnerabilities(components):
    """for each component in file check CPE and CVE APIs"""

    f = open("results.txt", "a")
    f.write(
        f"Componenet Vulnerability Scan, Date: {datetime.datetime.now()}\n\n")
    f.close()

    for c in components:
        cc = ComponentCheck(c)
        resp_cpe = cc.check_CPE_API()
        resp_cve = cc.check_CVE_API()
        results = cc.process_results(resp_cpe, resp_cve)
        cc.write_results_to_file(results)

    f = open("results.txt", "a")
    f.write("\n\n\n\n")
    f.close()


if __name__ == "__main__":
    f = open(sys.argv[1])
    data = json.load(f)
    f.close()
    check_each_component_vulnerabilities(data['components'])
